name: ğŸ·ï¸ Label Management - Setup Required Labels

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - '.github/workflows/setup-labels.yml'
      - 'spec/spec.yaml'

permissions:
  issues: write
  pull-requests: write

jobs:
  setup-labels:
    runs-on: ubuntu-latest
    name: Create Required Labels
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ·ï¸ Create/Update Labels
      run: |
        # ê¸°ë³¸ ìë™í™” ë¼ë²¨ë“¤
        declare -A LABELS
        
        # ìë™í™” ê´€ë ¨ ë¼ë²¨
        LABELS["auto-generated"]="ğŸ¤– Automatically generated issue or PR|#0052cc"
        LABELS["claude-task"]="ğŸ§  Task for Claude Code to process|#7b68ee"
        LABELS["orchestrator"]="ğŸ¼ Orchestrator system related|#ff6b6b"
        
        # ê°œë°œ ë‹¨ê³„ ë¼ë²¨
        LABELS["dev"]="ğŸ”¨ Development task|#28a745"
        LABELS["implementation"]="âš¡ Implementation phase|#20b2aa"
        LABELS["test"]="ğŸ§ª Testing related|#ffc107"
        LABELS["quality"]="â­ Quality assurance|#17a2b8"
        LABELS["integration"]="ğŸ”— Integration task|#6f42c1"
        LABELS["api"]="ğŸŒ API related work|#fd7e14"
        
        # ìƒíƒœ ë¼ë²¨
        LABELS["in-progress"]="ğŸš§ Work in progress|#fbca04"
        LABELS["review-needed"]="ğŸ‘€ Needs review|#d73a4a"
        LABELS["blocked"]="ğŸš« Blocked by dependency|#b60205"
        LABELS["completed"]="âœ… Task completed|#0e8a16"
        
        # ì—ëŸ¬/ì´ìŠˆ ë¼ë²¨
        LABELS["ci-failed"]="âŒ CI checks failed|#d73a4a"
        LABELS["human-intervention"]="ğŸ‘¤ Requires human intervention|#e99695"
        LABELS["retry-needed"]="ğŸ”„ Needs retry|#f9d71c"
        
        # ìš°ì„ ìˆœìœ„ ë¼ë²¨
        LABELS["priority-high"]="ğŸ”¥ High priority|#b60205"
        LABELS["priority-medium"]="âš¡ Medium priority|#fbca04"
        LABELS["priority-low"]="ğŸ“ Low priority|#0e8a16"
        
        # ê° ë¼ë²¨ ìƒì„±/ì—…ë°ì´íŠ¸
        for label_name in "${!LABELS[@]}"; do
          IFS='|' read -r description color <<< "${LABELS[$label_name]}"
          
          echo "Creating/updating label: $label_name"
          
          # ë¼ë²¨ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
          if gh label list | grep -q "^$label_name"; then
            echo "  â†’ Updating existing label: $label_name"
            gh label edit "$label_name" --description "$description" --color "$color" || {
              echo "  âš ï¸  Failed to update label: $label_name"
            }
          else
            echo "  â†’ Creating new label: $label_name"
            gh label create "$label_name" --description "$description" --color "$color" || {
              echo "  âš ï¸  Failed to create label: $label_name"
            }
          fi
        done
        
        echo "âœ… Label setup completed!"
        
      env:
        GH_TOKEN: ${{ github.token }}
        
    - name: ğŸ“Š List All Labels
      run: |
        echo "## ğŸ·ï¸ Current Repository Labels" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        gh label list --json name,description,color --jq '.[] | "- **\(.name)**: \(.description) `#\(.color)`"' >> $GITHUB_STEP_SUMMARY
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… **Label management completed!**" >> $GITHUB_STEP_SUMMARY
        
      env:
        GH_TOKEN: ${{ github.token }}
