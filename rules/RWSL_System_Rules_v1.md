# RWSL (Runway Status Lights) 시스템 규칙 v1.0

## 1. 시스템 개요

RWSL 시스템은 활주로 안전을 위한 자동 등화 제어 시스템으로, REL(Runway Entrance Lights)과 THL(Takeoff Hold Lights)로 구성됩니다.

### 1.1 시스템 구성
- **REL (Runway Entrance Lights)**: 유도로와 활주로 교차점에 설치, 활주로 진입 방지
- **THL (Takeoff Hold Lights)**: 활주로 상에 설치, 이륙 대기 항공기 제어
- **독립 운영 원칙**: 각 활주로(14L/32R, 14R/32L)는 독립적으로 운영

### 1.2 김포공항 활주로 구성
- **14L/32R**: 북쪽 활주로
- **14R/32L**: 남쪽 활주로
- **방향**: 14L/14R은 서쪽→동쪽, 32L/32R은 동쪽→서쪽

## 2. 우선순위 체계

### 2.1 활주로 점유 우선순위 (높음 → 낮음)
1. **LANDING_ROLLOUT**: 착륙 활주 중 (최우선)
2. **TAKEOFF_ROLLING**: 이륙 활주 중
3. **LANDING_APPROACH**: 착륙 접근 중 (1마일 이내, 500ft 이하)
4. **LINEUP**: 이륙 대기 (활주로 진입, 정지 상태)
5. **TAXI**: 지상 이동 (최하위)

### 2.2 항공기 상태 판정 기준
```
- AIRBORNE: 50kt + 500fpm + 100ft AGL
- TAKEOFF_ROLLING: 80kt 이상, 상승 중
- LANDING_ROLLOUT: 80kt 이상, 하강 중
- LANDING_TAXI: 34-80kt, 착륙 후
- TAXI: 5-34kt
- LINEUP: 5kt 미만
```

## 3. REL 제어 규칙

### 3.1 REL 활성화 조건
각 조건은 해당 활주로의 REL만 제어하며, 다중 조건 시 합집합(OR) 적용:

1. **LANDING_ROLLOUT**
   - 진행방향 전방 REL만 활성화
   - 이미 통과한 교차점 REL은 비활성화

2. **TAKEOFF_ROLLING**
   - 진행방향 전방 REL만 활성화
   - 이미 통과한 교차점 REL은 비활성화

3. **LANDING_APPROACH**
   - 해당 임계점의 모든 REL 활성화
   - 14L 접근 → 14L/32R 소속 유도로 REL
   - 32R 접근 → 14L/32R 소속 유도로 REL
   - 14R 접근 → 14R/32L 소속 유도로 REL
   - 32L 접근 → 14R/32L 소속 유도로 REL

4. **LINEUP**
   - 정렬된 임계점의 모든 REL 활성화
   - 활성화 범위는 APPROACH와 동일

### 3.2 REL 비활성화 조건

1. **이륙 완료 (Airborne)**
   - 즉시 해당 활주로 모든 REL 소등

2. **착륙 항공기 속도 기반 소등**
   - 80kt 이하: 30초 예상 경로 외부 REL 소등 시작
   - 34kt 이하: 해당 활주로 모든 REL 완전 소등

3. **2-3초 예측 소등**
   - 각 교차점 도달 2.5초 전 해당 REL 미리 소등
   - 착륙 항공기에만 적용

4. **타임아웃**
   - 30초 이상 활성화 시 자동 소등

## 4. THL 제어 규칙

### 4.1 THL 활성화 조건
LINEUP 항공기가 있을 때, 다음 조건 중 하나라도 만족하면 활성화:

1. 같은 활주로에 LANDING_ROLLOUT 존재
2. 같은 활주로에 TAKEOFF_ROLLING 존재 (457m/1500ft 이내)
3. 같은 방향 APPROACH 감지
4. 같은 활주로에 TAXI 횡단 중

### 4.2 THL 비활성화 조건
모든 위험 조건이 해제되면 즉시 소등

## 5. 속도 기반 제어 상세

### 5.1 착륙 항공기 REL 소등 단계
```
1단계 (80kt 도달):
- 30초 예상 경로 계산
- 경로에서 200m 이상 떨어진 REL 소등

2단계 (34kt 도달):
- 택시 상태 전환
- 모든 REL 완전 소등

병행 처리:
- 2-3초 예측 소등 (각 교차점별)
- 50m 이내 도달 예상 시 미리 소등
```

### 5.2 이륙 항공기 REL 제어
```
이륙 활주 (50kt 이상):
- 진행방향 전방 REL 활성화 유지

Airborne 감지:
- 50kt + 500fpm + 100ft AGL
- 모든 REL 즉시 소등
```

## 6. 유도로 매핑

### 6.1 유도로 위치
```
서쪽 끝: G, F (14L/14R 임계점 근처)
중앙부: C, D, E
동쪽 끝: A, B (32L/32R 임계점 근처)
특수: W1, W2 (32L 근처, General Aviation)
```

### 6.2 활주로별 유도로 소속
```
14L/32R 소속:
- A, B2, B1, C2, C1, C3, D1, D2, D3, E1, E2, F2, G2, G1

14R/32L 소속:
- G1, E1, D1, C1, W2, W1, B1

교차 유도로 (양쪽 활주로):
- G1, E1, D1, C1, B1
- OR 조건 적용 (하나라도 위험하면 활성화)
```

### 6.3 REL ID 매핑
```
패턴: REL_[유도로]_[방향]
예시:
- REL_A_D: A 유도로 출발(Departure) REL
- REL_B1_A: B1 유도로 도착(Arrival) REL
- REL_G2_D: G2 유도로 출발 REL
```

## 7. 예외 상황 처리

### 7.1 복수 항공기 동시 점유
- 가장 높은 우선순위 상태 기준 적용
- 필요한 REL 합집합 활성화

### 7.2 시스템 오류
- 해당 활주로만 안전 모드 (모든 등화 활성화)
- 다른 활주로는 정상 운영 지속

### 7.3 통신 두절
- 마지막 상태 30초 유지
- 이후 안전 모드 전환

## 8. 구현 가이드라인

### 8.1 처리 주기
- REL/THL 상태 업데이트: 100ms
- 충돌 감지: 1초
- 성능 목표: 900ms 이내 처리

### 8.2 공간 인덱싱
- 항공기 위치 기반 빠른 검색
- 활주로별 독립 인덱스 관리

### 8.3 상태 관리
- 각 REL/THL별 독립 상태
- 활성화 시간, 이유, 관련 항공기 추적
- 타임아웃 자동 관리

## 9. 진행방향 기반 제어 예시

### 9.1 14L 착륙 시나리오
```
항공기 위치: D2 통과
활성화 REL: C계열, B계열, A (진행방향 전방)
비활성화 REL: G계열, F계열, E계열, D계열 (이미 통과)
```

### 9.2 32L 접근 시나리오
```
접근 감지: 1마일, 400ft
활성화 REL: G1, E1, D1, C1, W2, W1, B1 (14R/32L 소속 전체)
```

### 9.3 교차 유도로 시나리오
```
14L 착륙 + 32L 접근
G1 REL: 두 조건 모두 해당 → 활성화
B1 REL: 32L 접근 조건 해당 → 활성화
A REL: 14L 착륙 진행방향 → 활성화
```

## 10. 버전 관리
- 버전: 1.0
- 작성일: 2025-01-27
- 작성자: RWSL 시스템 개발팀
- 다음 검토: 2025-02-27