# RWSL (Runway Status Lights) 시스템 규칙 v3.0

## 1. 시스템 개요

RWSL 시스템은 활주로 안전을 위한 자동 등화 제어 시스템으로, REL(Runway Entrance Lights)과 THL(Takeoff Hold Lights)로 구성됩니다.

### 1.1 시스템 구성
- **REL (Runway Entrance Lights)**: 유도로와 활주로 교차점에 설치, 활주로 진입 방지
- **THL (Takeoff Hold Lights)**: 활주로 상에 설치, 이륙 대기 항공기 제어
- **독립 운영 원칙**: 각 활주로(14L/32R, 14R/32L)는 독립적으로 운영

### 1.2 김포공항 활주로 구성
- **14L/32R**: 북쪽 활주로
- **14R/32L**: 남쪽 활주로
- **방향**: 14L/14R은 서쪽→동쪽, 32L/32R은 동쪽→서쪽

### 1.3 핵심 제어 원칙
- **점등 우선 원칙**: 소등 명령과 점등 명령이 충돌할 경우, 항상 점등이 우선
- **안전 우선**: 불확실한 상황에서는 등화를 점등 상태로 유지
- **독립 제어**: 각 활주로의 REL/THL은 독립적으로 제어

## 2. 우선순위 체계

### 2.1 활주로 점유 우선순위 (높음 → 낮음)
1. **LANDING_ROLLOUT**: 착륙 활주 중 (최우선)
2. **TAKEOFF_ROLLING**: 이륙 활주 중
3. **LANDING_APPROACH**: 착륙 접근 중 (1마일 이내, 500ft 이하, 헤딩 ±15도)
4. **LINEUP**: 이륙 대기 (활주로 진입, 정지 상태)
5. **TAXI**: 지상 이동 (최하위)

### 2.2 항공기 상태 판정 기준
```
- AIRBORNE: 50kt + 500fpm + 100ft AGL
- TAKEOFF_ROLLING: 80kt 이상, 상승 중
- LANDING_ROLLOUT: 80kt 이상, 착륙 후 활주 중
- LANDING_TAXI: 34-80kt, 착륙 후
- TAXI: 5-34kt
- LINEUP: 5kt 미만
```

## 3. REL 제어 규칙

### 3.1 REL 활성화 조건
각 조건은 해당 활주로의 REL만 제어하며, 다중 조건 시 합집합(OR) 적용:

1. **LANDING_ROLLOUT**
   - 진행방향 전방 REL만 활성화 (현재 위치부터 활주로 끝까지의 교차점)
   - 이미 통과한 교차점 REL은 비활성화
   - 속도별 단계적 소등 적용

2. **TAKEOFF_ROLLING**
   - 진행방향 전방 REL만 활성화 (현재 위치부터 활주로 끝까지의 교차점)
   - 이미 통과한 교차점 REL은 비활성화
   - Airborne 시 즉시 전체 소등

3. **LANDING_APPROACH**
   - 조건: 1마일 이내, 500ft 이하, 항공기 헤딩이 활주로 방향 ±15도 이내
   - 접근 임계점에 따른 REL 활성화:
     - 14L 접근 → 14L/32R 소속 유도로 REL 전체
     - 32R 접근 → 14L/32R 소속 유도로 REL 전체
     - 14R 접근 → 14R/32L 소속 유도로 REL 전체
     - 32L 접근 → 14R/32L 소속 유도로 REL 전체

4. **LINEUP**
   - 정렬된 임계점의 소속 유도로 REL 전체 활성화
   - 활성화 범위는 APPROACH와 동일

### 3.2 REL 비활성화 조건

**중요: 소등은 점등보다 낮은 우선순위. 점등 조건이 하나라도 있으면 소등하지 않음**

1. **이륙 완료 (Airborne)**
   - 50kt + 500fpm + 100ft AGL 충족 시
   - 즉시 해당 활주로 모든 REL 소등
   - 단, 다른 항공기에 의한 점등 조건이 없을 때만

2. **착륙 항공기 속도 기반 단계적 소등**
   ```
   1단계 (80kt 도달):
   - 30초 예상 경로 계산 (현재 속도 × 30초 = 예상 이동 거리)
   - 경로에서 200m 이상 떨어진 REL 소등
   - 다른 점등 조건이 없는 REL만 소등
   
   2단계 (34kt 도달):
   - 택시 상태 전환
   - 해당 활주로 모든 REL 완전 소등
   - 다른 점등 조건이 없는 REL만 소등
   ```

3. **2-3초 예측 소등**
   - 각 교차점 도달 2.5초 전 해당 REL 미리 소등
   - 50m 이내 도달 예상 시 적용
   - 착륙 항공기에만 적용
   - 다른 점등 조건이 없을 때만 소등

4. **타임아웃**
   - 30초 이상 활성화 시 자동 소등 검토
   - 다른 점등 조건 확인 후 소등
   - 시스템 안전성 확보

5. **활주로 이탈**
   - 항공기가 활주로 경계를 벗어난 경우
   - 해당 항공기에 의한 REL 점등 조건 해제
   - 다른 항공기 조건 확인 후 소등

## 4. THL 제어 규칙

### 4.1 THL 활성화 조건
LINEUP 항공기가 있을 때, 다음 조건 중 하나라도 만족하면 활성화:

1. 같은 활주로에 LANDING_ROLLOUT 존재
2. 같은 활주로에 TAKEOFF_ROLLING 존재 (457m/1500ft 이내)
3. 해당 임계점 방향 APPROACH 감지
4. 같은 활주로에 TAXI 횡단 중

### 4.2 THL 비활성화 조건
- 모든 위험 조건이 해제되면 즉시 소등
- 타임아웃: 30초
- **점등 우선 원칙 적용**: 하나라도 활성화 조건이 있으면 유지

## 5. 유도로 매핑 및 REL 제어

### 5.1 유도로 위치
```
서쪽 끝: G, F (14L/14R 임계점 근처)
중앙부: C, D, E
동쪽 끝: A, B (32L/32R 임계점 근처)
특수: W1, W2 (32L 근처, General Aviation)
```

### 5.2 활주로별 유도로 소속
```
14L/32R 소속:
- A, B2, B1, C2, C1, C3, D1, D2, D3, E1, E2, F2, G2, G1

14R/32L 소속:
- G1, E1, D1, C1, W2, W1, B1

교차 유도로 (양쪽 활주로 공유):
- G1, E1, D1, C1, B1
- OR 조건 적용 (어느 한 활주로라도 위험 시 활성화)
```

### 5.3 REL ID 체계
```
패턴: REL_[유도로]_[방향]
- [유도로]: A, B1, B2, C1, C2, C3, D1, D2, D3, E1, E2, F2, G1, G2, W1, W2
- [방향]: D(Departure) 또는 A(Arrival)

예시:
- REL_A_D: A 유도로 출발 REL
- REL_B1_A: B1 유도로 도착 REL
- REL_G2_D: G2 유도로 출발 REL
```

## 6. 진행방향 기반 선택적 REL 제어

### 6.1 진행방향 정의
```
14L 운영: 서쪽(G,F) → 동쪽(A,B)
32R 운영: 동쪽(A,B) → 서쪽(G,F)
14R 운영: 서쪽(G,F) → 동쪽(A,B)
32L 운영: 동쪽(A,B) → 서쪽(G,F)
```

### 6.2 LANDING_ROLLOUT/TAKEOFF_ROLLING 시 REL 제어
```
항공기 현재 위치 기준:
- 진행방향 전방: 현재 위치부터 활주로 끝까지의 모든 교차점
- 이미 통과한 교차점 REL은 비활성화 (단, 다른 점등 조건 없을 때)

예시 (14L 착륙, D2 통과):
- 활성화 유지: C계열, B계열, A (진행방향 전방)
- 소등 검토: G계열, F계열, E계열, D계열 (이미 통과)
- 소등 실행: 다른 항공기에 의한 점등 조건이 없는 REL만
```

## 7. 시간 기반 처리

### 7.1 즉시 반응 (0-100ms)
- Airborne 감지 → REL 소등 검토
- 활주로 진입 → REL 즉시 활성화
- 우선순위 변경 → 상태 업데이트

### 7.2 예측 처리 (2-3초)
- 교차점 도달 예측
- 충돌 가능성 계산
- 선제적 REL 제어 (점등 우선)

### 7.3 주기적 처리
- REL/THL 상태 업데이트: 100ms
- 충돌 감지: 1초
- 타임아웃 확인: 1초

## 8. 예외 상황 처리

### 8.1 복수 항공기 충돌 상황
```
동일 활주로:
- 가장 높은 우선순위 기준 적용
- 필요한 모든 REL 활성화 (합집합)
- 소등은 모든 점등 조건이 해제될 때만

교차 유도로:
- 양쪽 활주로 조건 OR 연산
- 하나라도 위험하면 REL 활성화
- 모든 조건 해제 시에만 소등
```

### 8.2 점등/소등 충돌 해결
```
원칙: 점등이 항상 우선
예시:
- A 항공기: REL_B1 소등 명령
- B 항공기: REL_B1 점등 명령
- 결과: REL_B1 점등 유지
```

### 8.3 시스템 이상
```
부분 장애:
- 해당 활주로만 안전 모드 (모든 등화 ON)
- 다른 활주로는 정상 운영
- 소등 명령 무시, 점등만 처리

전체 장애:
- 모든 등화 활성화
- 수동 제어 전환
- 자동 소등 비활성화
```

### 8.4 통신 두절
```
단계별 처리:
1. 마지막 상태 30초 유지
2. 안전 모드 전환 (모든 등화 ON)
3. 운영자 알림
4. 소등 명령 차단
```

## 9. 성능 및 구현 요구사항

### 9.1 성능 목표
- 전체 처리 시간: 900ms 이내
- REL 상태 변경: 100ms 이내
- 메모리 사용: 시스템 메모리의 10% 이내

### 9.2 데이터 구조
```
REL 상태:
- ID: string
- active: boolean
- activatedAt: timestamp
- reason: string
- relatedAircraft: string[]
- activationConditions: string[] (다중 점등 조건 추적)

공간 인덱스:
- 활주로별 독립 관리
- 그리드 기반 빠른 검색
```

### 9.3 로깅 및 모니터링
- 모든 상태 변경 기록
- 점등/소등 충돌 발생 시 상세 로그
- 성능 메트릭 실시간 추적
- 이상 상황 즉시 알림

## 10. 실제 운영 시나리오

### 10.1 표준 착륙 시나리오
```
1. 접근 (1마일, 500ft 이하, 헤딩 ±15도)
   - 해당 활주로 소속 REL 전체 활성화
   
2. 착륙 (터치다운)
   - LANDING_ROLLOUT 상태 전환
   - 진행방향 전방 REL만 유지
   - 통과한 REL 소등 검토
   
3. 감속 (80kt)
   - 30초 경로 계산 (속도 × 30초)
   - 경로 외부 REL 소등 시작
   - 다른 점등 조건 확인
   
4. 택시 전환 (34kt)
   - 모든 REL 소등 시도
   - 다른 항공기 조건 최종 확인
```

### 10.2 동시 운영 시나리오
```
14L 착륙 + 32L 접근:
- 14L/32R 소속: 착륙 항공기 진행방향 REL (점등)
- 14R/32L 소속: 전체 REL (접근으로 점등)
- 교차 유도로: 두 조건 모두 적용 (점등 유지)
- 소등: 각 조건이 개별적으로 해제될 때만
```

### 10.3 점등/소등 충돌 시나리오
```
상황: 14L 착륙 항공기 34kt 도달 (소등 조건)
      + 32R 접근 항공기 감지 (점등 조건)

처리:
1. 14L/32R 소속 REL 점등 유지 (점등 우선)
2. 14L 착륙 항공기 활주로 이탈 확인
3. 32R 접근 조건만 남음 → REL 유지
4. 32R 착륙 완료 후 최종 소등
```

## 11. 변경 이력

### v3.0 (2025-01-27)
- 점등 우선 원칙 추가 (소등은 점등보다 하위 명령)
- LANDING_APPROACH 조건에 헤딩 ±15도 추가
- 진행방향 전방 범위 명확화
- 30초 예상 경로 계산 방법 명시
- 활주로 이탈 처리 규칙 추가
- 항공기 상태 판정 기준 수정 (LANDING_ROLLOUT)
- 표준 착륙 시나리오 고도 수정

### v2.0 (2025-01-27)
- 방향 표현을 "진행방향 전방/후방"으로 통일
- REL 활성화 로직 명확화 (우선순위별 차별화)
- 교차 유도로 OR 조건 명시
- 속도 기반 제어 단계 상세화
- REL ID 체계 추가 (실제 구현 반영)
- 중복 제거 및 구조 개선
- 성능 요구사항 및 구현 가이드 추가

### v1.0 (2025-01-27)
- 초기 버전 작성

## 12. 승인 및 검토

- 작성자: RWSL 시스템 개발팀
- 검토자: 항공 안전 전문가
- 승인자: 프로젝트 관리자
- 다음 정기 검토: 2025-03-27