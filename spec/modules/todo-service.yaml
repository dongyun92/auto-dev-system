name: todo-service
description: "사용자별 할일 관리를 위한 CRUD API 서비스"
type: api_service
priority: high
estimated_hours: 3

dependencies:
  depends_on: ["database-setup", "auth-service"]
  
tech_stack:
  - spring-boot
  - spring-data-jpa
  - postgresql
  - validation

requirements:
  functional:
    - "할일 생성 API (POST /todos)"
    - "사용자의 모든 할일 조회 API (GET /todos)"
    - "특정 할일 조회 API (GET /todos/{id})"
    - "할일 수정 API (PUT /todos/{id})"
    - "할일 삭제 API (DELETE /todos/{id})"
    - "할일 완료 상태 토글 API (PATCH /todos/{id}/toggle)"
    - "완료된 할일만 조회 API (GET /todos?completed=true)"
    - "미완료 할일만 조회 API (GET /todos?completed=false)"
  
  non_functional:
    - "JWT 토큰 기반 인증 필수"
    - "사용자는 자신의 할일만 접근 가능"
    - "할일 제목은 필수, 최대 200자"
    - "할일 설명은 선택사항, 최대 1000자"
    - "페이징 지원 (기본 20개씩)"
    - "생성/수정 시간 자동 관리"

api_endpoints:
  - method: POST
    path: /todos
    description: "새 할일 생성"
    headers:
      Authorization: "Bearer access_token"
    request_body:
      title: string (required, max 200)
      description: string (optional, max 1000)
    responses:
      201: "할일 생성 성공"
      400: "잘못된 요청 (제목 누락, 길이 초과)"
      401: "인증되지 않은 사용자"
  
  - method: GET
    path: /todos
    description: "사용자의 모든 할일 조회"
    headers:
      Authorization: "Bearer access_token"
    query_parameters:
      completed: boolean (optional)
      page: integer (optional, default 0)
      size: integer (optional, default 20)
    responses:
      200: "할일 목록 반환"
      401: "인증되지 않은 사용자"
  
  - method: GET
    path: /todos/{id}
    description: "특정 할일 조회"
    headers:
      Authorization: "Bearer access_token"
    responses:
      200: "할일 정보 반환"
      401: "인증되지 않은 사용자"
      403: "접근 권한 없음 (다른 사용자의 할일)"
      404: "할일을 찾을 수 없음"
  
  - method: PUT
    path: /todos/{id}
    description: "할일 수정"
    headers:
      Authorization: "Bearer access_token"
    request_body:
      title: string (required, max 200)
      description: string (optional, max 1000)
    responses:
      200: "할일 수정 성공"
      400: "잘못된 요청"
      401: "인증되지 않은 사용자"
      403: "접근 권한 없음"
      404: "할일을 찾을 수 없음"
  
  - method: DELETE
    path: /todos/{id}
    description: "할일 삭제"
    headers:
      Authorization: "Bearer access_token"
    responses:
      204: "할일 삭제 성공"
      401: "인증되지 않은 사용자"
      403: "접근 권한 없음"
      404: "할일을 찾을 수 없음"
  
  - method: PATCH
    path: /todos/{id}/toggle
    description: "할일 완료 상태 토글"
    headers:
      Authorization: "Bearer access_token"
    responses:
      200: "상태 변경 성공"
      401: "인증되지 않은 사용자"
      403: "접근 권한 없음"
      404: "할일을 찾을 수 없음"

implementation:
  files_to_create:
    - "src/main/java/com/todo/todos/controller/TodoController.java"
    - "src/main/java/com/todo/todos/service/TodoService.java"
    - "src/main/java/com/todo/todos/dto/CreateTodoRequest.java"
    - "src/main/java/com/todo/todos/dto/UpdateTodoRequest.java"
    - "src/main/java/com/todo/todos/dto/TodoResponse.java"
    - "src/main/java/com/todo/todos/entity/Todo.java"
    - "src/main/java/com/todo/todos/repository/TodoRepository.java"
    - "src/main/java/com/todo/todos/exception/TodoNotFoundException.java"
    - "src/main/java/com/todo/todos/exception/TodoAccessDeniedException.java"

testing:
  unit_tests:
    - "TodoService 유닛 테스트"
    - "TodoRepository 테스트"
    - "DTO 검증 테스트"
    - "권한 검증 로직 테스트"
  
  integration_tests:
    - "할일 CRUD API 통합 테스트"
    - "권한 검증 통합 테스트"
    - "페이징 기능 테스트"
    - "필터링 기능 테스트"

completion_criteria:
  - "모든 할일 관리 API가 정상 작동"
  - "JWT 인증이 모든 엔드포인트에 적용"
  - "사용자별 할일 접근 권한이 올바르게 제한"
  - "입력 검증이 모든 필드에 적용"
  - "페이징과 필터링이 정상 작동"
  - "모든 테스트가 통과"